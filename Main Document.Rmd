---
title: Biodiversity improves tropical forest resilience
author: Sylvain Schmitt$^{*,1,2}$, Isabelle Maréchaux$^3$, Jerome Chave $^4$, Fabian Jörg Fischer$^4$, Camille  Piponiot$^5$, Stéphane Traissac$^6$, Bruno Hérault$^{*,7,8}$
output:
  bookdown::word_document2: default
  bookdown::pdf_document2:
    includes:
      before_body: ./template/doc_prefix.tex
      in_header: ./template/preamble.tex
    number_sections: no
    toc: no
    keep_tex: yes
linestretch: 1.5
csl: /home/sylvain/Documents/Bibliography/csl/joe.csl
bibliography: /home/sylvain/Documents/Bibliography/library.bib
link-citations: yes
---
 
```{r config, message=FALSE, warning=FALSE, include=FALSE}
rm(list = ls()); invisible(gc())
library(knitr)
library(kableExtra)
options(knitr.table.format = "latex") 
library(tidyverse)
library(broom)
theme_set(bayesplot::theme_default())
opts_chunk$set( echo = F, message = F, warning = F, 
                fig.height = 8, fig.width = 12,
                cache = T, cache.lazy = F)
```

```{r resilience, echo=FALSE}
rich <- c(5,25,125)
cvh <- 1:20
dist <- c(0,25,50,75)
path <- '~/Documents/ECOFOG/Results/disturbance/disturbance/data'
load(file.path(path, 'disturbanceDOE.Rdata'))
doe <- rename(doe, SR = richness)
load(file.path(path, 'disturbanceData.Rdata'))
load(file.path(path, 'disturbanceResilience.Rdata'))
```

```{r Deq, cache=TRUE, echo=FALSE}
Deq <- resilience %>% 
  group_by(time, sim) %>% 
  mutate_all(funs((1-.)^2)) %>% 
  mutate(structure = sqrt(sum(agb, ba, n, n10, n30))) %>% 
  mutate(production = sqrt(sum(gpp, npp, Rday, Rnight)))
```

```{r Ir, cache=TRUE, echo=FALSE}
Ir <- Deq %>% 
  group_by(sim) %>% 
  arrange(time) %>% 
  mutate_at(vars(-time, -sim), funs(1/cumsum(.))) %>% 
  filter(time == 600)
```

```{r BE, echo=FALSE}
load(file.path(path, 'disturbanceBE.Rdata'))
load(file.path(path, 'disturbanceBErecovery.Rdata'))
```

$^1$ CNRS, UMR EcoFoG (Agroparistech, Inra, Université des Antilles, Université de la Guyane, Cirad), Campus Agronomique, 97310 Kourou, French Guiana

$^2$ UMR BIOGECO, Université de Bordeaux, 69 route d’Arcachon, F-33612 Cestas cedex France

$^3$ AMAP, INRA, Univ Montpellier, IRD, CIRAD, CNRS, F-34000 Montpellier, France

$^4$ Laboratoire Evolution et Diversité Biologique, UMR5174, CNRS, Université Paul Sabatier, IRD, Toulouse Cedex 9, France

$^5$ Université de Guyane, UMR EcoFoG (Agroparistech, CNRS, Inra, Université des
Antilles, Cirad), Campus Agronomique, 97310 Kourou, French Guiana

$^6$ AgroParistech, UMR EcoFoG (CNRS, Inra, Université des Antilles, Université de la Guyane, Cirad), Campus Agronomique, 97310 Kourou, French Guiana

$^7$ Cirad, Univ Montpellier, UR Forests & Societies, Montpellier, France

$^8$ INP-HB, Institut National Polytechnique Félix Houphouët-Boigny, BP 1093, Yamoussoukro, Ivory Coast

__$^*$ Corresponding authorw:__ sylvain.schmitt@agroparistech.fr ; bruno.herault@cirad.fr

\newpage 

# Abstract

1. Climate change and direct human activities are modifying the disturbance regimes of tropical forests. Understanding the role of their high biological diversity in ecosystem recovery pathway and the underlying ecological mechanisms is of primary importance to predict the fate of tropical forests . Studies relying on permanent forest plots often lack repeatability, rarely include disturbed forests, and their temporal coverage remains too low to assess forest long-term dynamics. Forest simulators can thus prove useful to investigate the effect of biodiversity on forest functioning through virtual biodiversity experiments. However, the problem of biodiversity representation beyond a few plant functional types has long been an impediment in simulating species-rich tropical forests.
2. Using an individual-based and trait-based model of tropical forest, we assessed the effect of species and functional diversity on long-term forest recovery from disturbances of different levels by manipulating species number and functional assemblages across a large number of simulations. We further partitioned the net effect of biodiversity on ecosystem properties into complementarity and selection effects to investigate the ecological mechanisms that underlie the effect of biodiversity on forest functioning along recovery pathways.
3.  We found that functional diversity improved tropical forest resilience after disturbance. The ecological mechanisms underlying the effect of biodiversity on forest functioning changed in dominance along post-disturbance trajectories. The complementarity effect was dominant soon after disturbance and was progressively overtaken by a selection effect as more competitive species dominated the forest community, a pattern that increased with disturbance intensity.
4. *Synthesis*. We found that the mechanisms through which biodiversity influences forest functioning depend on the ecosystem state, shifting from a dominant complementarity effect in recently disturbed systems to a selection effect in anciently disturbed systems. Our results suggest that disturbance history is thus a key to our understanding of the biodiversity-ecosystem functioning relationships in tropical forests and can help reconcile contrasting results obtained previously with snapshots of ecosystem state in empirical studies.

## Keywords

Resilience; Recovery; Functional diversity; Tropical forest; Complementarity effect; Selection effect; Biodiversity-ecosystem functioning.

\newpage 

# Introduction 

Climate change and direct human activities are currently deeply modifying forest disturbance regimes [@Davidson2012; @Lewis2015]. While deforestation has been the focus of worldwide attention, the consequences of human-induced disturbance on tropical forests have been less studied [@Putz2010; @Simula2009]. Degraded forests currently cover areas over ten times larger than deforested ones [@Herold2011], a majority of which is being unsustainably logged for timber production [@Blaser2011]. Forest degradation triggers severe biodiversity loss [@Burivalova2014] and is estimated to account for 2.1 billion of tons of carbon dioxide emissions per year representing 25% of greenhouse gas emissions related to deforestation and forest degradation globally [@Pearson2017].  In addition to direct human impact on forests, climate change modifies regional climates with, for instance, projected increases in the frequency and intensity of convective storms in the Amazon increasing wind-related tree mortality [@Negron-Juarez2018]. Understanding the drivers of tropical forest resilience to disturbances is thus critical. Here we explored the role of biodiversity in tropical forest recovery after disturbance through a simulation approach.

Ecological resilience refers to the ecosystem ability to resist and recover from disturbance [@Gunderson2010]. Post-disturbance recovery is determined by various factors, among which (i) the disturbance intensity which determines to a large extent the time to recover the ecosystem biomass, lost biodiversity, and tree species composition [@Burivalova2014; @DeAvila2015; @Rutishauser2015], (ii)  the pre-disturbance tree assemblage  as species respond differently to disturbances depending on their ecological strategies and functional properties [@herault_functional_2011] and (iii) tree community diversity which also fosters forest resilience to disturbances [@Cadotte2011; @Ives2007; @Loreau2013].

Two types of mechanisms can underlie the effect of biodiversity on ecosystem properties: complementarity and selection [@Loreau2001]. The complementarity effect results from resource partitioning and niche differentiation, and from facilitation, leading to a more efficient use of available resources at the community level. The selection effect describes how more diverse communities have a higher probability of including functionally efficient species. Moreover, the sampling effect implies redundancy and a lower risk to lose important functional traits, further improving resilience of species rich-forest [@Hooper2005a; @Tilman2001]. Previous theoretical work [@Loreau2010], experiments [@Cardinale2007; @Cardinale2009; @Niklaus2017a; @Huang2018], and direct observations along natural gradients [@Chisholm2013; @Liang2016; @Paquette2011; @Poorter2017] suggest that both complementarity and selection mechanisms may play a role in ecosystem biomass stock and dynamics [@VanderSande2017a], and their  relative importance can vary in time [@Fargione2007; @Huang2018].

In tropical forests, the role of biodiversity in ecosystem recovery and the underlying mechanisms remain under-documented [@VanderSande2017]. Studies relying on forest stand inventories often lack repeatability [@Poorter2017; @Schnitzer2016], rarely include disturbed forests [@Sist2015], and temporal coverage remains too low to assess long-term effects [@Herault2018]. Forest simulators have thus proven useful to investigate the effect of biodiversity on forest functioning through virtual biodiversity experiments [@Morin2011; @Morin2014a; @Sakschewski2016; @Bohn2017]. However, the problem of biodiversity representation beyond a few plant functional types has long been an impediment in applying this approach to species-rich tropical forests [@Kazmierczak2014; @Kohler1998; @Purves2008].

In the present study, we take advantage of recent developments made in the forest simulator TROLL [@Chave1999], an individual-based and spatially-explicit model of tropical forest that simulates high-diversity levels through a species-specific parameterization using plant functional traits [@Marechaux2017]. Consequently, TROLL offers the opportunity to study biodiversity-ecosystem functioning  relationships *in silico*. We used a simulation approach to assess the effect of species and functional diversity on long-term forest recovery from disturbances of different levels. We manipulated species number and functional identity across a large number of simulations, and measured the net effect of biodiversity on forest preperties along recovery pathways. To further investigate the underlying ecological mechanisms, we partitioned this net effect into complementarity and selection effects. Based on the general trend of a positive relationships between biodiversity and productivity [@Liang2016], we hypothesized that more diverse forests would recover quicker from a disturbance event due to an increased productivity.

# Material and Methods

## TROLL Model

TROLL is an individual-based and spatially explicit forest dynamic model (details in @Marechaux2017). In TROLL, the life cycle (recruitment, growth, seed production, and death) is simulated for individual trees $>1\textrm{cm}$ diameter at breast height (dbh). Trees grow in a light environment computed within a $1\textrm{m}^3$ voxel grid. Seedlings below the $1\textrm{cm}$ size class are not modeled on an individual basis, but are part of a seed/seedlings pool. A maximum of one tree can establish per square meter. Once established, the tree is defined by age, dbh, height (h), crown radius (CR), crown depth (CD) and leaf area (LA). Tree geometry is calculated with allometric relationships. Additionally, each tree is flagged with a species label inherited from the parent tree through seedling recruitment. To each species label is associated a number of species-specific traits (Table \@ref(tab:traits)) from which ecophysiological processes are simulated using relationships drawn from the literature. The model thus represents tree biodiversity in a realistic way, where data requirement and model outputs parallel current trait collection efforts and field inventories.

Carbon assimilation is computed over half-hourly period of a representative day per month using the Farquhar, von Caemmerer, and Berry model of photosynthesis [@Farquhar1980].  Photosynthetic capacities, as well as leaf respiration rate, are computed from species-specific leaf concentration of nitrogen (N) and phosphorous (P), and leaf mass per area [LMA; @Atkin2015; @Domingues2010]. The net amount of assimilated carbon allocated to growth is then partitioned among the different plant organs using empirical factors. Yhe fraction allocated to woody growth is converted into increments of stem volume using species-specific wood density, while the fraction allocated to leaves is converted into leaf area increment using LMA. Leaf demography is simulated using species-specific leaf lifespan derived from LMA. Here we did not use the same relationship between LMA and leaf lifespan as in @Marechaux2017, as we found that it generated an underestimation of leaf lifespan for low LMA species. We thus designed a new leaf lifespan allometry, specific to tropical tree species, used throughout this study (see supplementary materials S1). Natural tree deaths are stochastic events and their rate is negatively correlated with wood density within TROLL, as observed pan-tropically [@kraft_functional_2010; @poorter_are_2008; @Wright2010] and locally [@Aubry-Kientz2013]. Additionally, trees can die due to carbon starvation or treefalls. Below-ground processes, herbaceous plants, epiphytes and lianas are not simulated. The source code is written in C++ and version 2.3.1 used in this study is available at https://github.com/TROLL-code/TROLL.

In order to have a general overview of disturbance effect, a generic disturbance module was developed for this study. At a given iteration $disturb_{iter}$, individual trees are randomly picked following a uniform law, targeting neither individuals nor species. This ensures that there are no confounding factors due to disturbance type specificity. Selected individuals are then removed without triggering a treefall to control disturbed biomass volume. The operation is repeated until the cumulative basal area of removed trees reaches the targeted threshold ($disturb_{intensity}$).

## Simulation experiment

In order to assess the role of biodiversity on ecosystem recovery from disturbance, we  simulated forest trajectories for different levels of disturbance intensity ($disturb_{intensity}$) and tree community compositions. For each simulation, we first conducted a spin-up run, where we simulated forest regeneration from bare soil for 600 years (pre-disturbance step). We then simulated the disturbance described as above ($disturb_{iter}$), and finally let the simulated forest community freely recover from the disturbance during 600 years (post-disturbance step). Disturbance intensity ($disturb_{intensity}$) was fixed at 0% (control), 25%, 50% or 75% of basal area loss. For each level of disturbance, we performed 20 simulations differing in the original number of species (species richness $SR\{15,25,125\}$) and in floristic composition. For each level of species richness, we first created 1000 virtual communities by randomly picking the desired number of species among the regional species pool. Then of those 1000 communities, we selected 20 communities with a large range of functional trait convex hull volume $CVH$ [@Cornwell2006a] but with a community mean ($CM$) close to the one of the regional species pool ($CM_{LMA} = 115 \pm 19 ~\textrm{g.m}^{-2}$, $CM_{wsg} = 0.73 \pm 0.07~\textrm{g.cm}^{-3}$, $CM_{dmax} = 0.37 \pm 0.1~\textrm{m}$, $CM_{hmax} = 40 \pm 11~\textrm{m}$) in order to control for average functional composition. This led to 240 simulations varying in community composition and disturbance intensity ($3~SR*20~CHV*4~ levels~of~disturbance$).

All simulations were made with a parameterization for an Amazonian forest of French Guiana, picked in a pool of 163 parameterized species, as in @Marechaux2017.

## Analysis

### Quantifying simulated community diversity

Species and functional diversities were assessed for each simulation at the end of the pre-disturbance step with species richness ($SR$) and functional diversity indices [$FDiv$, the volume of the functional space occupied by the community, and $FEve$, the regularity of the distribution of abundance in this volume; @villeger_dynamique_2008] using the `FD` R package [@laliberte_distance-based_2010-1].

### Ecosystem recovery from disturbance

Simulated tropical forests were characterized in terms of changes in ecosystem properties regarding (i) forest structure (aboveground biomass ($AGB$ in $\textrm{Mg~C.ha}^{-1}$), basal area ($BA$ in $\textrm{m}^2.\textrm{ha}^{-1}$), total number of stem ($N$), number of stem above $10~\textrm{cm}$ diameter ($N10$), and number of stem above $30~\textrm{cm}$ diameter ($N30$)) and (ii) forest functioning (growth primary productivity ($GPP$ in $\textrm{MgC.ha}^{-1}$), net primary productivity ($NPP$ in $\textrm{MgC.ha}^{-1}$), tree autotrophic day-time respiration ($Rday$ in $\textrm{MgC.ha}^{-1}$) and tree autotrophic night-time respiration ($Rnight$ in $\textrm{MgC.ha}^{-1}$)).

The recovery of the simulated forest at a time $t$, $R(t)$ regarding a given property $X$ was defined as follows (Fig. \@ref(fig:IrGraphFinal)):

\begin{equation}
  R[X(t)] = \frac{X_D(t)}{X_C(t)}
  (\#eq:Recovery)
\end{equation}

where $X_D(t)$ and $X_C(t)$ are the values for the ecosystem property $X$ at time $t$ in the disturbed simulation ($disturb_{intensity} = 25\%, 50\%, 75\%$) and in the control simulation ($disturb_{intensity} = 0\%$), respectively. Note that variability among replicated simulations with the same set-up, due to demographic stochasticity in the model, is low enough to assume that a given simulation is representative of the community properties and dynamics given an initial species pool and disturbance intensity [@Marechaux2017].

When $R(t)$ approaches $R_{eq}=1$, the disturbed and control systems are considered equivalent, indicating a perfect recovery. We then calculated the Euclidean distance to this state of perfect recovery as $d_{eq}(t) = \sqrt{(R_{eq}-R(t))^2}$ (Fig. \@ref(fig:IrGraphFinal)). Because we set up the intensity of disturbance, our analysis did not include any ecosystem resistance, i.e. the ecosystem capacity to absorb a disturbance event. We used the inverse of the cumulative Euclidean distance to the equilibrium as an index of ecosystem resilience, further defined as $I_R$ (Fig. \@ref(fig:IrGraphFinal)):

\begin{equation}
  I_R(X) = \frac 1 {\int _{t=disturb_{iter}} ^{t=disturb_{iter}+600} d_{eq}(t).dt}
  (\#eq:Resilience)
\end{equation}

A high value of $I_R$ indicates a high resilience. Distance to equilibrium $d_{eq}$ and resilience index $I_R$ were calculated in a multi-dimensional space for the two sets of ecosystem property values: (i) forest structure ($AGB$, $BA$, $N$, $N10$, and $N30$) and (ii) forest functioning ($GPP$, $NPP$, $Rday$, and $Rnight$). 

### Biodiversity effect

We tested the influence of three factors on the resilience index $I_R$: pre-disturbance species richness ($SR$), functional evenness ($FEve$) and functional diversity ($FDiv$):
$$log(I_R) \sim \mathcal{N} (\Theta _{SR} + \Theta _{FEve} \times Feve + \Theta _{FDiv} \times Fdiv; \sigma^2)$$
where $\Theta _{SR}$ is a vector of 3 parameters corresponding to  the 3 species richness levels, $\Theta _{FEve}$ and $\Theta _{FDiv}$ respectively model the effect of $FEve$ and $FDiv$ on $I_R$  under a normal law of variance $\sigma^2$. The analysis was conducted twice for each disturbance level (25%, 50% and 75% of basal area loss): one with forest structure properties and one with forest functioning properties. We used the AIC to select the final, most-parsimonious, models. The ecosystem resilience index IR was log-transformed to improve residuals’ normality.

For each ecosystem property $X$, we investigated the effect of biodiversity and its variation along post-disturbance trajectories. The net effect of biodiversity ($NE$) on ecosystem property $X$ is defined as the difference between the ecosystem property $X$ of the simulated mixed-species community and the one expected under the null hypothesis. The latter would mean that there is no effect of biodiversity, i.e. that ecosystem property $X$ for the mixed-species community equals the relative abundance-weighted sum of that in monoculture [@Loreau2001]. In order to do so, we simulated a monoculture of each of the 163 species and for each level of disturbance leading to 652 simulations of monocultures.

We then partitioned this net biodiversity effect into complementarity and selection effect using @Loreau2001's partitioning procedure:

\begin{equation}
  \begin{array}{c}
    NE = CE + SE \\
    CE = N* \overline{\Delta RX} \overline{M}\\
    SE = N*cov(\Delta RX,M)
  \end{array}
  (\#eq:BiodivPart)
\end{equation}

where $N$ represents the total number of species, and $M$ is the vector of $X$ for the 163 simulations in monoculture. Finally, $\Delta RX$ is as follows:

\begin{equation}
  \Delta RX_{sp} = \frac{X_{sp}(mixture)}{X_{sp}(monoculture)} - P_{sp}
  (\#eq:DeltaRY)
\end{equation}

where $X_{sp}$ is the ecosystem variable value for one species either in mixture $X_{sp}(mixture)$ or in monoculture $X_{sp}(monoculture)$. $P_{sp}$ is the relative abundance of the species in the mixture. Biodiversity net effect $NE$ can vary over time due to stochasticity, in the absence of disturbance. To correctly assess selection and complementarity effect, we normalized $NE$ by the value $NE_C$, calculated from the control simulation ($disturb_{intensity} = 0\%$) to measure the recovery of the net biodiversity effect $R(NE)$:

\begin{equation}
  R(NE) = \frac{NE}{NE_C} = \frac{SE}{NE_C} + \frac{CE}{NE_C}
  (\#eq:RNE)
\end{equation}


# Results

## Biodiversity effect on forest resilience

As species richness ($SR$) increased from 5 to 125 species, functional diversity varied from $0.76\pm0.18$ to $0.96\pm0.02$ and evenness ($FEve$) varied from $0.46\pm0.24$ to $0.64\pm0.02$. Species richness ($SR$) was never retained by the AIC selection procedure, whatever the disturbance intensity. Both functional diversity ($FDiv$) and functional evenness ($FEve$) were positively related with $I_R$, i.e. forest resilience increased with both functional diversity and functional evenness (Fig. \@ref(fig:gIr) and Table \@ref(tab:tgIr)). Similar results were obtained for all disturbance levels, with higher significance for higher disturbance intensity. Model R2s were slightly lower for forest structure (from 0.18 to 0.27) than for forest functioning (from 0.27 to 0.51) variables. While FDiv was the most significant variable for forest structure models, Feve became prominent for forest functioning models (Table \@ref(tab:tgIr)).

## Post-disturbance trajectories of biodiversity effect

The net effect of biodiversity on each ecosystem property was quantified and partitioned into selection and complementarity effects (Table \@ref(tab:tNE)). The net effect was positive across most ecosystem variables, apart from 2, *i.e.* the number of stems above 10cm DBH and the net primary production for which the average net effects were negative, albeit not significantly different from 0. Regarding the aboveground biomass, we found that the complementarity effect sharply increased immediately after disturbance, was the dominant effect of biodiversity during the first decades and then progressively vanished (Fig. \@ref(fig:gBE)). When increasing the disturbance intensity, the effect of complementarity increased further and dominated even longer. The selection effect, on the other hand, sharply decreased just after disturbance, and only gradually came to play a more important role, dominating the net biodiversity effect ca. a century after disturbance. Finally, at high disturbance intensity, the net effect of biodiversity on aboveground biomass was still lower than the control 600 years after disturbance (Fig. \@ref(fig:gBE)). We found similar results, but with an amplified signal, for basal area ($BA$) and stem abundance ($N$). Finally, forest growth primary production ($GPP$) recovered only within a few years with a dominant complementarity effect.

# Discussion

Using an *in silico* experiment, we investigated the effect of biodiversity on tropical forest resilience to disturbance and the variation of biodiversity effect on ecosystem functioning along the recovery trajectory. We found that functional diversity improved tropical forest recovery from disturbance with underlying ecological mechanisms changing in dominance with time. Complementarity effect was dominant soon after disturbance and was progressively overtaken by a selection effect, as more competitive species dominated the forest community, a pattern that increased with disturbance intensity. Overall, our results suggest that pre-disturbance history is key to our understanding of the ecological mechanisms that underlie the resilience of tropical forests. This can help reconciling previous contrasted results obtained with limited snapshots of ecosystem state.

## Functional diversity accelerates tropical forest recovery

Our results provide strong evidence of a significant positive relationship between functional diversity and forest recovery rate. In particular, the volume of the functional space occupied by the community [@villeger_new_2008], and its evenness component, both turned out to be major predictors of system resilience, as they helped avoid an overreliance on a few dominant species and the consequent vulnerability to their loss. This can be due to (i) temporal complementarity, with the diversity of species response to disturbances and response asynchronicity, resulting in ecological sorting [@Loreau2013; @Sakschewski2016; @Morin2014a], and (ii) functional dissimilarity reducing competition strength [@Loreau2013]. Our results thus confirm @Daz2001a, advocating for an under-evaluated importance of plant functional diversity in ecosystem processes, and @Zhang2012 who highlighted the role of evenness in productivity of forest ecosystems. With our model simulations, we provide strong evidence that the high diversity of functional traits in tropical forests may represent an insurance against human-induced changes in disturbance regimes by maintaining a high ecosystem resilience.

## Shifting effects along the successional trajectory ensure forest recovery

We found that complementarity among species was the prevailing effect of biodiversity on forest functioning just after a disturbance. This is a direct consequence of the appearance of natural gaps and an increased heterogeneity in light availability, the main limiting resource in dense tropical forest. Species are known to vary widely in their demographic response to light availability depending on their functional strategy [@Herault2010;@Ruger2009]. Pioneer species with productive leaf tissue and light wood tend to occupy gaps fast after their opening, hence creating a shaded environment where late successional species with more conservative leaf tissue later establish. By inducing a higher diversity of shade tolerance and growth response to light in the species pool, species richness hence fosters forest response to perturbations [@Morin2011]. This complementarity effect decreased through time while the selection effect progressively gained in dominance. The diminished complementarity effect can be attributed to the increased abundance of the most competitive species in more stable and less heterogeneous environments.

## Implications of modelling choices

In this study we used an individual-based forest simulator to jointly simulate biodiversity and ecosystem functioning, and we explored the effect of biodiversity on forest resilience over centuries, a timeframe that remains out of reach of most experimental approaches.

As any modelling approach, our study comes with simplifications and assumptions. In our simulations, light was the unique resource whose variability was explicitly accounted for [@Marechaux2017]. Our analysis thus simulated a situation where aboveground competition for light overcomes the effect of belowground competition for water and nutrients, a reasonable assumption in humid tropical forests, even in early successional stages [@VanBreugel2012]. However, this assumption may be less suitable under predicted increases in drought intensity and frequency in many tropical areas [@Duffy2015]. Furthermore, we did not include the effect of topography, known to result in high local heterogeneity. We would expect a stronger role of complementarity effect through hydrological and edaphic niche partitioning as water become locally more limited in more heterogeneous landscapes [@Baltzer2005; @Jucker2018; @Silvertown2004a]. Additionally, our simulations did not take into account the secondary effects of disturbances on community structure, such as damage to surrounding trees or secondary treefalls. These might introduce more spatial clustering (i.e. larger gaps) and play on the spatial grain. Effectively, @Chisholm2013 and @Sullivan2017 found that the biodiversity effect varies across spatial scales, with typically stronger effects at smaller scales (*e.g.* 0.04-ha).

Finally, we simulated a generic form of disturbance, and our findings might differ with more specific types of disturbance. For instance, selective logging target a few species, and this could lower the selection effect in the long-term if dominant species are repeatedly chosen. Recurring disturbances such as periodic harvests, would increase the prevalence of early recovery stages during which complementarity effect plays the largest role. Consequently, species complementarity could have an even bigger importance in forest recovery after repeated disturbances that target most frequent species.

## Looking at temporal dynamics unifies biodiversity-ecosystem functioning studies

Previous biodiversity-ecosystem functioning studies are not consistent on dominant biodiversity effects. The complementarity effect has been highlighted as the dominant effect in diverse experimental plantation [@Huang2018; @Niklaus2017a] and reported within disturbed-by-logging forests [@Poorter2017]. The selection effect, on the other hand, has been shown as prevailing (i) in young [@Tobner2016] and old [@Bauters2015] experimental plantations, (ii) in simulated old-growth tropical forests [@Marechaux2017], and (iii) in natural undisturbed [@Finegan2015], secondary [@Lohbeck2016] or logged, thinned and burnt [@DeAvila2018] forests. 

However, our results suggest that the mechanisms through which biodiversity influence forest functioning strongly depend on the current ecosystem state and its previous history of disturbances, with complementarity effect dominating in recently disturbed ecosystems and selection effect taking over complementarity in anciently disturbed systems. Effectively, @Huang2018, @Niklaus2017a and @Poorter2017 did find a stronger complementarity effect in species-rich ecosystems recently disturbed either by plantation or logging (8 years-old, 14 to 32 years-old, and 18 years old respectively). Contrarily, anciently disturbed or undisturbed forests showed dominant selection effect (77 years old planted forest for @Bauters2015; undisturbed forest for @Finegan2015; 500 years old simulated forest for @Marechaux2017). In addition, the dominant selection effect observed in plantations by @Tobner2016 or in secondary forest by @Lohbeck2016 might be explained by the recent ecosystem conversion, from agricultural field and fallow respectively, resulting in the absence of already existing tree diversity (see supplementary materials S2).

Together, our results pave the way to a unifying framework to reconcile the apparent contradictions between previous studies advocating for the sole effect of complementarity or selection effects, and call for an accurate description of the ecosystem temporal context and past-history in future studies aiming at improving our understanding of biodiversity and ecosystem functioning relations. This further open perspectives to a better prediction of ecosystem resilience in a context of increasing disturbances and biodiversity crisis.

# Supplementary materials

* Supplementary materials S1: Leaf lifespan model
* Supplementary materials S2: Biodiversity trajectories

# Acknowledgements

This study was funded by the GFclim project (FEDER 20142020, Project GY0006894) and an Investissement d’Avenir grant of the ANR (CEBA: ANR-10-LABEX-0025).

# Authors’ contributions

SS, BH and ST conceived the ideas, designed methodology and analysed model outputs; SS, IM and BH led the writing of the manuscript. All authors contributed critically to the drafts and gave final approval for publication.

# References {-}

<div id="refs"></div>

\newpage 

## Table captions

__Table \@ref(tab:traits)__ Species-specific parameters used in TROLL from @Marechaux2017 Data originates from the BRIDGE [@Baraloto2010] and TRY [@Kattge2011] datasets.

__Table \@ref(tab:tgIr)__ Effects of functional diversity on forest resilience. Results of the linear models testing the effect of functional diversity indices (FDiv and FEve) on the resilience index ($I_R$) for forest structure and functioning and for each level of disturbance intensity ($disturb_{intensity}$). To meet the assumption of normality $I_R$ was log-transformed. Values of FDiv and FEve are the model coefficients. Significant $P-values$ are shown in bold. ns, non-significant; . p < 0.1; * p < 0.05; ** p < 0.01; *** p < 0.001.

__Table \@ref(tab:tNE)__ Mean and standard deviation of the biodiversity net effect across mature simulations before the disturbance event (i.e. after 600 years of regeneration) for different ecosystem variables.

## Figure captions

__Figure \@ref(fig:IrGraphFinal)__ Definition of recovery function R and resilience index $I_R$ shown for aboveground biomass dynamics for a simulation with $disturb_{intensity}=50\%$.

__Figure \@ref(fig:gIr)__ Variation of forest resilience with taxonomic and functional diversity for different levels of disturbance. Resilience index $I_R$ was represented against functional diversity ($FDiv$) for different levels of disturbance ($disturb_{intensity}$} = 25, 50 and 75% of total basal area); dot shapes varies with species richness whereas dot color indicates functional evenness ($FEve$). Solid lines and grey areas show fitted relationships with their mean and variance of the form $I_R = FDiv + \epsilon$.

__Figure \@ref(fig:gBE)__ Post-disturbance trajectories of complementarity and selection effects on aboveground biomass for increasing levels of disturbance (25%, 50% and 75% of basal area loss). The net biodiversity ($NE$), complementarity ($CE$) and selection ($SE$) effects were normalized by the net effect of biodiversity in the control simulation ($disturb_{intensity}=0\%$). Solid lines represents the mean value whereas shaded areas represent the range of values across the 20 simulations with a species richness ($SR$) of 125. Time axis has been square-root transformed to highlight first decades dynamic.

\newpage 

<!-- tables -->

```{r traits, echo=FALSE}
table <- data.frame(
  Abbreviation = c('$LMA$', '$N_m$', '$P_m$', '$wsg$', '$dbh_{thresh}$', '$h_{lim}$', '$a_h$'),
  Description = c('leaf mass per area', 'leaf nitrogen content per dry mass', 'leaf phosphorous content per dry mass', 'wood specific gravity', 'diameter at breast height threshold', 'asymptotic height', 'parameter of the tree height-dbh allometry'),
  Units = c('$\\textrm{g.m}^{-2}$', '$\\textrm{mg.g}^{-1}$', '$\\textrm{mg.g}^{-1}$', '$\\textrm{g.cm}^{-3}$', '$\\textrm{m}$', '$\\textrm{m}$', '$\\textrm{m}$')
)
knitr::kable(table, caption = 'Species-specific parameters used in TROLL from @Marechaux2017 Data originates from the BRIDGE [@Baraloto2010] and TRY [@Kattge2011] datasets.', format = 'pandoc')
```

```{r tgIr}
Ir %>% 
  left_join(doe, by = "sim") %>% 
  ungroup() %>% 
  mutate(SR = as.numeric(SR)) %>% 
  select(disturbance, structure, production,
         SR, FEve, FDiv) %>% 
  reshape2::melt(id.vars = c("disturbance", "SR", "FEve", "FDiv"), 
                 variable.name = "Ir") %>% 
  group_by(Ir, disturbance) %>%
  do(fit = lm(log(value) ~ FEve + FDiv, data = .)) %>% 
  tidy(fit) %>% 
  ungroup() %>% 
  filter(term != "(Intercept)") %>% 
  filter(!grepl("SR", term)) %>% 
  mutate(`P-value` = ifelse(p.value < 0.001, "***",
                            ifelse(p.value < 0.01, "**",
                                   ifelse(p.value < 0.05, "*",
                                          ifelse(p.value < 0.1, ".", 
                                                 "n.s."))))) %>% 
  mutate(Coefficient = round(estimate,2)) %>% 
  mutate(value = paste(Coefficient, `P-value`)) %>%
  mutate(value = cell_spec(value,
                           bold = ifelse(grepl("*", value,
                                               fixed = T), T, F))) %>%
  reshape2::dcast(Ir + disturbance ~ term, value.var = "value") %>% 
  left_join(Ir %>% 
              left_join(doe, by = "sim") %>% 
              ungroup() %>% 
              mutate(SR = as.factor(SR)) %>% 
              select(disturbance, structure, production,
                     SR, FEve, FDiv) %>% 
              reshape2::melt(id.vars = c("disturbance", "SR", "FEve", "FDiv"), 
                             variable.name = "Ir") %>% 
              group_by(Ir, disturbance) %>%
              do(fit = lm(log(value) ~ FEve + FDiv, data = .)) %>% 
              glance(fit) %>% 
              mutate(r.squared = round(r.squared, 2)) %>% 
              select(Ir, disturbance, r.squared)) %>% 
  mutate(Ir = ifelse(Ir == "production", "functioning", "structure")) %>% 
  kable(caption = "Effects of functional diversity on forest resilience. Results of the linear models testing the effect of functional diversity indices (FDiv and FEve) on the resilience index ($I_R$) for forest structure and functioning and for each level of disturbance intensity ($disturb_{intensity}$). To meet the assumption of normality $I_R$ was log-transformed. Values of FDiv and FEve are the model coefficients. Significant $P-values$ are shown in bold. ns, non-significant; . p < 0.1; * p < 0.05; ** p < 0.01; *** p < 0.001.",
        col.names = c("$log(I_R)$", "Disturbance intensity",
                      "FDiv", "FEve", "$R^2$"), escape = F, format = "pandoc") %>% 
  kable_styling(full_width = F) %>% 
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:2)
```

```{r tNE, echo=FALSE, cache=TRUE}
library(reshape2)
library(knitr)
BE %>%
  mutate(agb = agb/1000) %>% 
  filter(BE == 'NE') %>%
  melt(id.vars = c('BE', 'time', 'sim')) %>% 
  left_join(., doe, by = 'sim') %>%
  filter(SR == 125) %>%
  filter(disturbance == 0) %>%
  group_by(variable) %>% 
  summarise(mean = mean(value, na.rm = T), 
            sd = sd(value, na.rm = T)) %>% 
  filter(variable != 'n30') %>% 
  bind_cols(., data.frame(
    name = c('aboveground biomass', 'basal area', 'number of stems', 
             'number of stems above 10 cm dbh', 'growth primary production', 
             'net primary production', 'autotrophic respiration during day',
             'autotrophic respiration during night'),
    unit = c('$\\textrm{MgC.ha}^{-1}$', '$\\textrm{m}^2.\\textrm{ha}^{-1}$', '$\\textrm{n.ha}^{-1}$', '$\\textrm{n.ha}^{-1}$', 
             '$\\textrm{MgC.ha}^{-1}\\textrm{.yr}^{-1}$', '$\\textrm{MgC.ha}^{-1}\\textrm{.yr}^{-1}$', 
             '$\\textrm{MgC.ha}^{-1}\\textrm{.yr}^{-1}$', '$\\textrm{MgC.ha}^{-1}$\\textrm{.yr}^{-1}'))) %>% 
  mutate(NE = paste0("$", round(mean,2), "\\pm", round(sd,2), "$")) %>% 
  select(name, NE, unit) %>% 
  kable(caption = 'Mean and standard deviation of the biodiversity net effect across mature simulations before the disturbance event (i.e. after 600 years of regeneration) for different ecosystem variables.',
        format = 'pandoc', col.names = c("Ecosystem property", "Net effect", "Unit")) %>% 
  kable_styling(full_width = F)
```

<!-- figures -->

```{r IrGraphFinal, fig.cap="Definition of recovery function R and resilience index $I_R$ shown for aboveground biomass dynamics for a simulation with $disturb_{intensity}=50\\%$."}
knitr::include_graphics("images/figure3.png") 
```

```{r gIr, echo=FALSE, fig.cap='Variation of forest resilience with taxonomic and functional diversity for different levels of disturbance. Resilience index $I_R$ was represented against functional diversity ($FDiv$) for different levels of disturbance ($disturb_{intensity}$} = 25, 50 and 75% of total basal area); dot shapes varies with species richness whereas dot color indicates functional evenness ($FEve$). Solid lines and grey areas show fitted relationships with their mean and variance of the form $I_R = FDiv + \\epsilon$.', fig.height=12, fig.width=12, dpi=600}
Ir %>% 
  left_join(doe, by = "sim") %>% 
  ungroup() %>% 
  select(disturbance, 
         structure, production,
         SR, FEve, FDiv) %>% 
  reshape2::melt(id.vars = c("disturbance", "SR", "FEve", "FDiv"), 
                 variable.name = "Resilience", value.name = "Ir") %>% 
  ggplot(aes(FDiv, Ir, shape = SR, col = FEve, group = NA)) +
  geom_smooth(method = 'lm', alpha = 0.3, colour= 'grey') +
  geom_point(size = 4) +
  facet_wrap(disturbance~Resilience, scales = "free", labeller = 'label_both',
             nrow = 3) + 
  xlab('Functional diversity (FDiv)') +
  ylab('Resilience indice Ir') +
  scale_shape_discrete('Species\nrichness\n(SR)') +
  scale_color_continuous('Functional\nevenness\n(FEve)') +
  theme(text = element_text(size=20),
        legend.key.size=unit(4,"line"))
```

```{r gBE, echo=FALSE, fig.cap='Post-disturbance trajectories of complementarity and selection effects on aboveground biomass for increasing levels of disturbance (25%, 50% and 75% of basal area loss). The net biodiversity ($NE$), complementarity ($CE$) and selection ($SE$) effects were normalized by the net effect of biodiversity in the control simulation ($disturb_{intensity}=0\\%$). Solid lines represents the mean value whereas shaded areas represent the range of values across the 20 simulations with a species richness ($SR$) of 125. Time axis has been square-root transformed to highlight first decades dynamic.', fig.height=12, dpi=600}
BEresilience %>% 
  left_join(., doe, by = 'sim') %>%
  filter(SR == 125) %>% 
  # filter(BE %in% c('SE', 'CE')) %>%
  group_by(time, BE, disturbance, SR) %>%
  summarise(qt1 =quantile(agb, probs=0.05),
            qt2 =quantile(agb, probs=0.75),
            mean=mean(agb),
            n=n()) %>% 
  ggplot(aes(x = time)) +
  geom_hline(yintercept = 1, color = 'red') +
  geom_hline(yintercept = 0, color = 'blue') +
  geom_ribbon(aes(ymin = qt1, ymax = qt2, fill = BE), alpha = 0.3) +
  geom_line(aes(y = mean, color = BE)) +
  facet_grid(disturbance ~ SR, labeller = 'label_both') +
  xlab('Time since disturbance (years)') +
  ylab('Biodiversity effect on aboveground biomass') +
  scale_x_sqrt() +
  theme(text = element_text(size=20),
        legend.key.size=unit(2,"line"))
```
